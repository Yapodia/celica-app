# Generated by Django 5.2.1 on 2025-06-30 13:15

from django.db import migrations


def fix_all_extra_fields(apps, schema_editor):
    """Ajoute des valeurs par d√©faut √† tous les champs suppl√©mentaires"""
    
    with schema_editor.connection.cursor() as cursor:
        print("üîß Correction finale de tous les champs suppl√©mentaires...")
        
        # Corriger les champs suppl√©mentaires dans celica_web_reponse
        corrections = [
            {
                'table': 'celica_web_reponse',
                'field': 'reponse_donnee',
                'sql': "ALTER TABLE celica_web_reponse MODIFY COLUMN reponse_donnee TINYINT(1) DEFAULT 0"
            },
            {
                'table': 'celica_web_reponse',
                'field': 'correct',
                'sql': "ALTER TABLE celica_web_reponse MODIFY COLUMN correct TINYINT(1) DEFAULT 0"
            }
        ]
        
        for correction in corrections:
            try:
                cursor.execute(correction['sql'])
                print(f"‚úÖ {correction['table']}.{correction['field']}: valeur par d√©faut ajout√©e")
            except Exception as e:
                print(f"‚ö†Ô∏è {correction['table']}.{correction['field']}: {e}")
        
        print("üéØ Correction finale termin√©e avec succ√®s !")


def reverse_fix_all_extra_fields(apps, schema_editor):
    """Inverse les modifications (pour le rollback)"""
    
    with schema_editor.connection.cursor() as cursor:
        try:
            cursor.execute("ALTER TABLE celica_web_reponse MODIFY COLUMN reponse_donnee TINYINT(1)")
            cursor.execute("ALTER TABLE celica_web_reponse MODIFY COLUMN correct TINYINT(1)")
        except Exception:
            pass


class Migration(migrations.Migration):

    dependencies = [
        ('celica_web', '0009_add_ordre_to_reponse'),
    ]

    operations = [
        migrations.RunPython(
            fix_all_extra_fields,
            reverse_fix_all_extra_fields
        ),
    ]
